{% load static %}

{% for schedule in schedules %}
<link rel="stylesheet" href="{% static 'hospital/minhas-escalas.css'}">

<a href="{% url 'hospital:schedule_detail' schedule.id %}" class="conteudo2 text-decoration-none">
    <div class="bloco-escala p-5 pb-4 mt-4 rounded-4 shadow border text-dark">

        <!-- Título e ações -->
        <div class="d-flex justify-content-between align-items-start mb-3 flex-wrap">
            <!-- Título e período -->
            <div>
                <h3 class="mb-1 fw-bold {% if schedule.status == 'Arquivado' %}text-muted-custom{% elif schedule.status == 'Publicado' %}text-custom{% else %}text-primary{% endif %}"
                    style="font-size: 1.5em;">
                    #{{ schedule.id }} - {{ schedule.name }}
                </h3>
                <div
                    class="{% if schedule.status == 'Arquivado' %}text-muted-custom{% elif schedule.status == 'Publicado' %}text-custom{% else %}text-primary{% endif %} d-inline-flex align-items-center">
                    {% if schedule.status == 'Publicado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_cobertura_criacao_minhas_escalas_1.svg' %}" alt="Período"
                        width="20" height="20" class="me-2">
                    {% elif schedule.status == 'Arquivado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_cobertura_criacao_minhas_escalas_2.svg' %}" alt="Período"
                        width="20" height="20" class="me-2">
                    {% else %}
                    <img src="{% static 'hospital/img/schedule_list/icone_cobertura_criacao_minhas_escalas.svg' %}" alt="Período"
                        width="20" height="20" class="me-2">
                    {% endif %}
                    <span>Período: {{ schedule.period }}</span>
                </div>
            </div>

            <!-- Status e Excluir -->
            <div class="d-flex align-items-center gap-4 mt-2 mt-md-0">
                <!-- Status -->
                <div class="d-flex align-items-center">
                    {% if schedule.status == "Arquivado" %}
                    <img src="{% static 'hospital/img/schedule_list/icone_arquivado_minhas_escalas.svg' %}" alt="Status" width="20" height="20" class="me-2">
                    {% elif schedule.status == "Publicado" %}
                    <img src="{% static 'hospital/img/schedule_list/icone_zero_conflitos_minhas_escalas.svg' %}" alt="Status" width="20" height="20" class="me-2">
                    {% else %}
                    <img src="{% static 'hospital/img/schedule_list/icone_em_rascunho_minhas_escalas.svg' %}" alt="Status" width="20" height="20" class="me-2">
                    {% endif %}

                    <span
                        class="fw-semibold {% if schedule.status == 'Arquivado' %}text-muted-custom{% elif schedule.status == 'Publicado' %}text-custom{% else %}text-primary{% endif %}"
                        style="font-size: 1.1rem;">
                        
                        {% if is_doctor %}
                            {% if schedule.status == "Arquivado" %}
                                Escala arquivada pelo setor.
                            {% elif schedule.status == "Publicado" %}
                                Escala disponível para você.
                            {% endif %}
                        {% else %}
                            {% if schedule.status == "Arquivado" %}
                                Arquivado com sucesso!
                            {% elif schedule.status == "Publicado" %}
                                Publicado com sucesso!
                            {% else %}
                                Em rascunho
                            {% endif %}
                        {% endif %}
                        
                    </span>
                </div>

                {% if schedule.status == "Rascunho" %}
                <!-- Link de excluir -->
                <a href="#" 
                    class="btn-excluir-escala d-flex align-items-center text-decoration-none fw-semibold"
                    style="font-size: 1.1rem; cursor: pointer;"
                    data-id="{{ schedule.id }}">
                    <img src="{% static 'hospital/img/schedule_list/icone_excluir_escala_minhas_escalas.svg' %}" alt="Excluir" width="20" height="20" class="me-1">
                    Excluir escala
                </a>
                {% endif %}
            </div>
        </div>

        <hr>

        <!-- Informações principais -->
        <div class="d-flex flex-wrap justify-content-between gap-3 mt-2">

            <div class="flex-shrink-0" style="min-width: 220px;">
                <div
                    class="mb-1 {% if schedule.status == 'Arquivado' %}text-muted-custom{% else %}text-custom{% endif %}">
                    Criado por:</div>
                <div class="d-inline-flex align-items-center">
                    {% if schedule.status == 'Publicado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_perfil_minhas_escalas_1.svg' %}" alt="Perfil" width="20"
                        height="20" class="me-2">
                    {% elif schedule.status == 'Arquivado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_perfil_minhas_escalas_2.svg' %}" alt="Perfil" width="20"
                        height="20" class="me-2">
                    {% else %}
                    <img src="{% static 'hospital/img/schedule_list/icone_perfil_minhas_escalas.svg' %}" alt="Perfil" width="20"
                        height="20" class="me-2">
                    {% endif %}
                    <span
                        class="form-label m-0 {% if schedule.status == 'Arquivado' %}text-muted-custom{% else %}text-custom{% endif %}">
                        {{ schedule.manager_name }}
                    </span>
                </div>
            </div>

            <div class="flex-shrink-0" style="min-width: 200px;">
                <div
                    class="mb-1 {% if schedule.status == 'Arquivado' %}text-muted-custom{% else %}text-custom{% endif %}">
                    Setor:</div>
                <div class="d-inline-flex align-items-center">
                    {% if schedule.status == 'Publicado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_setor_minhas_escalas_1.svg' %}" alt="Setor" width="20"
                        height="20" class="me-2">
                    {% elif schedule.status == 'Arquivado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_setor_minhas_escalas_2.svg' %}" alt="Setor" width="20"
                        height="20" class="me-2">
                    {% else %}
                    <img src="{% static 'hospital/img/schedule_list/icone_setor_minhas_escalas.svg' %}" alt="Setor" width="20" height="20"
                        class="me-2">
                    {% endif %}
                    <span
                        class="form-label m-0 {% if schedule.status == 'Arquivado' %}text-muted-custom{% else %}text-custom{% endif %}">
                        {{ schedule.department.name }}
                    </span>
                </div>
            </div>

            <div class="flex-shrink-0" style="min-width: 200px;">
                <div
                    class="mb-1 {% if schedule.status == 'Arquivado' %}text-muted-custom{% else %}text-custom{% endif %}">
                    Conflitos:</div>
                <div
                    class="d-inline-flex align-items-center {% if schedule.num_conflicts > 0 %}text-warning{% endif %}">
                    {% if schedule.num_conflicts > 0 %}
                    <i class="bi bi-exclamation-triangle-fill me-2"
                        style="font-size: 20px; line-height: 1; vertical-align: middle;"></i>
                    {% else %}
                    {% if schedule.status == 'Publicado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_zero_conflitos_minhas_escalas_1.svg' %}" alt="Cobertura"
                        width="20" height="20" class="me-2">
                    {% elif schedule.status == 'Arquivado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_zero_conflitos_minhas_escalas_2.svg' %}" alt="Cobertura"
                        width="20" height="20" class="me-2">
                    {% else %}
                    <img src="{% static 'hospital/img/schedule_list/icone_zero_conflitos_minhas_escalas.svg' %}" alt="Cobertura"
                        width="20" height="20" class="me-2">
                    {% endif %}
                    {% endif %}
                    <span
                        class="form-label m-0 {% if schedule.status == 'Arquivado' %}text-muted-custom{% else %}text-custom{% endif %}">
                        {{ schedule.num_conflicts }} conflito{{ schedule.num_conflicts|pluralize }}
                    </span>
                </div>
            </div>

            <div class="flex-shrink-0" style="min-width: 200px;">
                <div
                    class="mb-1 {% if schedule.status == 'Arquivado' %}text-muted-custom{% else %}text-custom{% endif %}">
                    Cobertura:</div>
                <div class="d-inline-flex align-items-center">
                    {% if schedule.status == 'Publicado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_cobertura_criacao_minhas_escalas_1.svg' %}" alt="Cobertura"
                        width="20" height="20" class="me-2">
                    {% elif schedule.status == 'Arquivado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_cobertura_criacao_minhas_escalas_2.svg' %}" alt="Cobertura"
                        width="20" height="20" class="me-2">
                    {% else %}
                    <img src="{% static 'hospital/img/schedule_list/icone_cobertura_criacao_minhas_escalas.svg' %}" alt="Cobertura"
                        width="20" height="20" class="me-2">
                    {% endif %}
                    <span
                        class="form-label m-0 {% if schedule.status == 'Arquivado' %}text-muted-custom{% else %}text-custom{% endif %}">
                        {{ schedule.num_shifts }} 
                        {% if schedule.num_shifts == 1 %}
                            plantão
                        {% else %}
                            plantões
                        {% endif %}
                    </span>
                </div>
            </div>

            <div class="flex-shrink-0" style="min-width: 200px;">
                <div
                    class="mb-1 {% if schedule.status == 'Arquivado' %}text-muted-custom{% else %}text-custom{% endif %}">
                    Criação:</div>
                <div class="d-inline-flex align-items-center">
                    {% if schedule.status == 'Publicado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_cobertura_criacao_minhas_escalas_1.svg' %}" alt="Criação"
                        width="20" height="20" class="me-2">
                    {% elif schedule.status == 'Arquivado' %}
                    <img src="{% static 'hospital/img/schedule_list/icone_cobertura_criacao_minhas_escalas_2.svg' %}" alt="Criação"
                        width="20" height="20" class="me-2">
                    {% else %}
                    <img src="{% static 'hospital/img/schedule_list/icone_cobertura_criacao_minhas_escalas.svg' %}" alt="Criação"
                        width="20" height="20" class="me-2">
                    {% endif %}
                    <span
                        class="form-label m-0 {% if schedule.status == 'Arquivado' %}text-muted-custom{% else %}text-custom{% endif %}">
                        {{ schedule.criated_at }}
                    </span>
                </div>
            </div>

        </div>

    </div>
</a>
{% empty %}
<div class="d-flex flex-column justify-content-center align-items-center text-center py-5 w-100">
    <img src="{% static 'hospital/img/schedule_list/icone_sem_escalas_minhas_escalas.svg' %}" alt="Sem escalas em rascunho"
        style="max-width: 147px; opacity: 50%;" class="mb-3">
    <p class="text-muted fs-5">Nenhuma escala criada</p>
</div>
{% endfor %}
<script src="{% static 'hospital/js/utils.js' %}"></script>
<script src="{% static 'hospital/js/schedules-delete.js' %}"></script>